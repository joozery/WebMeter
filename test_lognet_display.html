<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test LogNet Display</title>
</head>
<body>
    <h1>Test LogNet Display</h1>
    
    <h2>API Endpoints Test:</h2>
    <button onclick="testGetLocations()">Get All Locations</button>
    <button onclick="testGetLogNets()">Get All LogNets</button>
    <button onclick="testGetLogNetsWithLocationNames()">Get LogNets with Location Names</button>
    <button onclick="testCreateLogNet()">Create Test LogNet</button>
    
    <h3>Results:</h3>
    <div id="results" style="background: #f5f5f5; padding: 10px; margin: 10px 0; white-space: pre-wrap; font-family: monospace;"></div>
    
    <script>
        const API_BASE = '/api/meter-tree';
        
        async function testGetLocations() {
            try {
                const response = await fetch(`${API_BASE}/locations`);
                const data = await response.json();
                document.getElementById('results').textContent = 
                    'GET /locations:\n' + JSON.stringify(data, null, 2);
            } catch (error) {
                document.getElementById('results').textContent = 'Error: ' + error.message;
            }
        }
        
        async function testGetLogNets() {
            try {
                const response = await fetch(`${API_BASE}/lognets`);
                const data = await response.json();
                document.getElementById('results').textContent = 
                    'GET /lognets:\n' + JSON.stringify(data, null, 2);
            } catch (error) {
                document.getElementById('results').textContent = 'Error: ' + error.message;
            }
        }
        
        async function testGetLogNetsWithLocationNames() {
            try {
                const response = await fetch(`${API_BASE}/lognets`);
                const data = await response.json();
                
                // แสดงข้อมูล LogNets พร้อม location references
                const formattedData = data.map(lognet => ({
                    id: lognet.id,
                    name: lognet.name,
                    location_id: lognet.location_id,
                    sublocation_id: lognet.sublocation_id,
                    main_location_name: lognet.main_location_name,
                    sub_location_name: lognet.sub_location_name,
                    model: lognet.model,
                    brand: lognet.brand,
                    serial_number: lognet.serial_number,
                    firmware_version: lognet.firmware_version,
                    ip_address: lognet.ip_address,
                    subnet_mask: lognet.subnet_mask,
                    gateway: lognet.gateway,
                    dns: lognet.dns,
                    is_active: lognet.is_active
                }));
                
                document.getElementById('results').textContent = 
                    'GET /lognets (with location names):\n' + JSON.stringify(formattedData, null, 2);
            } catch (error) {
                document.getElementById('results').textContent = 'Error: ' + error.message;
            }
        }
        
        async function testCreateLogNet() {
            try {
                // สร้าง LogNet ใหม่
                const response = await fetch(`${API_BASE}/lognets`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        location_id: 1, // ใช้ location_id = 1
                        sublocation_id: null,
                        name: 'Test LogNet ' + new Date().toLocaleTimeString(),
                        model: 'Test Model',
                        brand: 'Test Brand',
                        serial_number: 'SN' + Date.now(),
                        firmware_version: 'v1.0',
                        ip_address: null,
                        subnet_mask: null,
                        gateway: null,
                        dns: null,
                        is_active: true
                    })
                });
                const data = await response.json();
                document.getElementById('results').textContent = 
                    'POST /lognets:\n' + JSON.stringify(data, null, 2);
            } catch (error) {
                document.getElementById('results').textContent = 'Error: ' + error.message;
            }
        }
    </script>
</body>
</html>
