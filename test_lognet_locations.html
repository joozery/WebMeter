<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test LogNet with Location References</title>
</head>
<body>
    <h1>Test LogNet with Location References</h1>
    
    <h2>Expected Structure:</h2>
    <pre>
üè¢ Main Location (location_id)
‚îú‚îÄ‚îÄ üìÅ Sub Location (sublocation_id)
‚îÇ   ‚îî‚îÄ‚îÄÔ∏è LogNet System (‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á Main + Sub)
‚îî‚îÄ‚îÄÔ∏è LogNet System (‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á Main ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô)
    </pre>
    
    <h2>API Endpoints Test:</h2>
    <button onclick="testGetLocations()">Get All Locations</button>
    <button onclick="testGetLogNets()">Get All LogNets</button>
    <button onclick="testCreateMainLocation()">Create Main Location</button>
    <button onclick="testCreateSubLocation()">Create Sub Location</button>
    <button onclick="testCreateLogNetInMain()">Create LogNet in Main</button>
    <button onclick="testCreateLogNetInSub()">Create LogNet in Sub</button>
    
    <h3>Results:</h3>
    <div id="results" style="background: #f5f5f5; padding: 10px; margin: 10px 0; white-space: pre-wrap; font-family: monospace;"></div>
    
    <script>
        const API_BASE = '/api/meter-tree';
        let mainLocationId = null;
        let subLocationId = null;
        
        async function testGetLocations() {
            try {
                const response = await fetch(`${API_BASE}/locations`);
                const data = await response.json();
                document.getElementById('results').textContent = 
                    'GET /locations:\n' + JSON.stringify(data, null, 2);
            } catch (error) {
                document.getElementById('results').textContent = 'Error: ' + error.message;
            }
        }
        
        async function testGetLogNets() {
            try {
                const response = await fetch(`${API_BASE}/lognets`);
                const data = await response.json();
                document.getElementById('results').textContent = 
                    'GET /lognets:\n' + JSON.stringify(data, null, 2);
            } catch (error) {
                document.getElementById('results').textContent = 'Error: ' + error.message;
            }
        }
        
        async function testCreateMainLocation() {
            try {
                const response = await fetch(`${API_BASE}/locations`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        name: 'Test Main Location',
                        description: 'Test main location',
                        parent_id: null
                    })
                });
                const data = await response.json();
                mainLocationId = data.id;
                document.getElementById('results').textContent = 
                    'POST /locations (Main):\n' + JSON.stringify(data, null, 2);
            } catch (error) {
                document.getElementById('results').textContent = 'Error: ' + error.message;
            }
        }
        
        async function testCreateSubLocation() {
            try {
                if (!mainLocationId) {
                    document.getElementById('results').textContent = 'Please create main location first.';
                    return;
                }
                
                const response = await fetch(`${API_BASE}/locations`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        name: 'Test Sub Location',
                        description: 'Test sub location',
                        parent_id: mainLocationId
                    })
                });
                const data = await response.json();
                subLocationId = data.id;
                document.getElementById('results').textContent = 
                    'POST /locations (Sub):\n' + JSON.stringify(data, null, 2);
            } catch (error) {
                document.getElementById('results').textContent = 'Error: ' + error.message;
            }
        }
        
        async function testCreateLogNetInMain() {
            try {
                if (!mainLocationId) {
                    document.getElementById('results').textContent = 'Please create main location first.';
                    return;
                }
                
                const response = await fetch(`${API_BASE}/lognets`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        location_id: mainLocationId,
                        sublocation_id: null,
                        name: 'LogNet in Main Location',
                        model: 'Test Model',
                        brand: 'Test Brand',
                        serial_number: 'SN001',
                        firmware_version: 'v1.0',
                        ip_address: null,
                        subnet_mask: null,
                        gateway: null,
                        dns: null,
                        is_active: true
                    })
                });
                const data = await response.json();
                document.getElementById('results').textContent = 
                    'POST /lognets (Main Location):\n' + JSON.stringify(data, null, 2);
            } catch (error) {
                document.getElementById('results').textContent = 'Error: ' + error.message;
            }
        }
        
        async function testCreateLogNetInSub() {
            try {
                if (!mainLocationId || !subLocationId) {
                    document.getElementById('results').textContent = 'Please create main and sub locations first.';
                    return;
                }
                
                const response = await fetch(`${API_BASE}/lognets`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        location_id: mainLocationId,
                        sublocation_id: subLocationId,
                        name: 'LogNet in Sub Location',
                        model: 'Test Model',
                        brand: 'Test Brand',
                        serial_number: 'SN002',
                        firmware_version: 'v1.0',
                        ip_address: null,
                        subnet_mask: null,
                        gateway: null,
                        dns: null,
                        is_active: true
                    })
                });
                const data = await response.json();
                document.getElementById('results').textContent = 
                    'POST /lognets (Sub Location):\n' + JSON.stringify(data, null, 2);
            } catch (error) {
                document.getElementById('results').textContent = 'Error: ' + error.message;
            }
        }
    </script>
</body>
</html>
